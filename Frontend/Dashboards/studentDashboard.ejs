<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Student Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  </head>
  <body class="bg-gray-100 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-md p-4">
      <div class="container mx-auto flex justify-between items-center">
        <h1 class="text-2xl font-bold">Student Dashboard</h1>
        <div class="flex gap-4">
          <a href="/render/Home">
            <button class="px-6 py-3 bg-black hover:bg-gray-800 font-semibold text-white rounded-xl transition-colors">
              Home
            </button>
          </a>
          <a href="/render/Library">
            <button class="px-6 py-3 bg-black hover:bg-gray-800 font-semibold text-white rounded-xl transition-colors">
              Library
            </button>
          </a>
          <a href="/auth/student/logout">
            <button class="px-6 py-3 bg-black hover:bg-gray-800 font-semibold text-white rounded-xl transition-colors">
              Logout
            </button>
          </a>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="container mx-auto p-6">
      <!-- Student Info Card -->
      <div class="bg-white rounded-2xl shadow-md p-6 mb-6">
        <h2 class="text-2xl font-bold mb-4">Student Information</h2>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <p class="text-gray-600">Name: <span class="font-semibold text-black"><%= student.name %></span></p>
            <p class="text-gray-600">Email: <span class="font-semibold text-black"><%= student.email %></span></p>
            <p class="text-gray-600">Enrollment Number: <span class="font-semibold text-black"><%= student.enrollmentNumber %></span></p>
          </div>
          <div>
            <p class="text-gray-600">Course: <span class="font-semibold text-black"><%= student.course %></span></p>
            <p class="text-gray-600">Year: <span class="font-semibold text-black"><%= student.year %></span></p>
            <p class="text-gray-600">Books Borrowed: <span class="font-semibold text-black"><%= borrowedBooks.length %></span></p>
          </div>
        </div>
      </div>

      <!-- Borrowed Books Section -->
      <div class="bg-white rounded-2xl shadow-md p-6">
        <h2 class="text-2xl font-bold mb-4">Borrowed Books</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          <% if (borrowedBooks.length === 0) { %>
            <p class="col-span-full text-center text-gray-500">No books borrowed yet</p>
          <% } else { %>
            <% borrowedBooks.forEach(function(book) { %>
              <div class="bg-gray-50 rounded-xl p-4">
                <h3 class="text-xl font-bold mb-2"><%= book.title %></h3>
                <p class="text-gray-600 mb-2">by <%= book.author %></p>
                <p class="text-sm text-gray-500 mb-2 line-clamp-2"><%= book.description %></p>
                <div class="flex flex-wrap gap-2 mb-3">
                  <% book.genre.forEach(function(genre) { %>
                    <span class="bg-gray-800 text-white text-xs px-3 py-1 rounded-full"><%= genre %></span>
                  <% }); %>
                </div>
                <button 
                  class="w-full px-4 py-2 bg-red-600 text-white font-semibold rounded-xl 
                  hover:bg-red-700 transition-colors flex items-center justify-center gap-2"
                  onclick="returnBook('<%= book._id %>')"
                >
                  <i class="fa-solid fa-book-bookmark"></i>
                  Return Book
                </button>
              </div>
            <% }); %>
          <% } %>
        </div>
      </div>
    </div>

    <script>
      function returnBook(bookId) {
        fetch('/student/returnbook', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify({ bookId }),
          credentials: 'include'
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert('Book returned successfully!');
            location.reload();
          } else {
            alert(data.message || 'Error returning book');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('Error returning book');
        });
      }
    </script>
  </body>
</html>
